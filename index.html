<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>three.js CSS3D Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
        body { margin:0; overflow:hidden; background:#000; color:#8ff; font-family:Helvetica; }

        .item {
            width:120px;
            height:160px;
            border:1px solid rgba(127,255,255,0.4);
            box-shadow:0 0 12px rgba(0,255,255,0.4);
            text-align:center;
            position:relative;
            background:rgba(0,127,127,0.4);
        }

        .symbol {
            font-size:48px;
            margin-top:20px;
            color:white;
            text-shadow:0 0 10px cyan;
        }

        #menu {
            position:absolute;
            bottom:20px;
            width:100%;
            text-align:center;
        }
        button{
            color:#8ff;
            background:transparent;
            padding:6px 12px;
            border:1px solid #8ff;
            cursor:pointer;
        }
        button:hover { background:rgba(0,255,255,0.3); }
    </style>
</head>
<body>

<div id="container"></div>

<div id="menu">
    <button id="btn-table">TABLE</button>
    <button id="btn-sphere">SPHERE</button>
    <button id="btn-helix">HELIX</button>
    <button id="btn-grid">GRID</button>
</div>

<!-- Importmap -->
<script type="importmap">
{
    "imports":{
        "three":"https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/":"https://unpkg.com/three@0.160.0/examples/jsm/"
    }
}
</script>

<script type="module">
import * as THREE from 'three';
import { CSS3DRenderer, CSS3DObject } from 'three/addons/renderers/CSS3DRenderer.js';
import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
import TWEEN from 'three/addons/libs/tween.module.js';

let camera, scene, renderer, controls;
const objects = [];
const targets = { table: [], sphere: [], helix: [], grid: [] };

init();
animate();

function init() {

    camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
    camera.position.z = 2000;

    scene = new THREE.Scene();

    const symbols = ["A","B","C","D","E","F","G","H","I","J"];

    for (let i = 0; i < symbols.length; i++) {

        const div = document.createElement("div");
        div.className = "item";

        const s = document.createElement("div");
        s.className = "symbol";
        s.textContent = symbols[i];
        div.appendChild(s);

        const obj = new CSS3DObject(div);
        obj.position.set(
            Math.random()*4000-2000,
            Math.random()*4000-2000,
            Math.random()*4000-2000
        );

        scene.add(obj);
        objects.push(obj);

        const tablePos = new THREE.Object3D();
        tablePos.position.x = (i % 5) * 250 - 500;
        tablePos.position.y = Math.floor(i / 5) * -300 + 200;
        targets.table.push(tablePos);
    }

    const vec = new THREE.Vector3();
    const l = objects.length;

    for (let i = 0; i < l; i++) {
        const phi = Math.acos(-1 + (2 * i) / l);
        const theta = Math.sqrt(l * Math.PI) * phi;

        const obj = new THREE.Object3D();
        obj.position.setFromSphericalCoords(600, phi, theta);
        vec.copy(obj.position).multiplyScalar(2);
        obj.lookAt(vec);

        targets.sphere.push(obj);
    }

    for (let i = 0; i < l; i++) {
        const theta = i * 0.35;
        const y = -(i * 50) + 300;

        const obj = new THREE.Object3D();
        obj.position.setFromCylindricalCoords(600, theta, y);

        vec.set(obj.position.x * 2, y, obj.position.z * 2);
        obj.lookAt(vec);

        targets.helix.push(obj);
    }

    for (let i = 0; i < l; i++) {
        const obj = new THREE.Object3D();
        obj.position.set(
            (i % 5) * 250 - 500,
            (Math.floor(i / 5) % 2) * -300 + 150,
            Math.floor(i / 10) * 800 - 400
        );
        targets.grid.push(obj);
    }

    renderer = new CSS3DRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById("container").appendChild(renderer.domElement);

    controls = new TrackballControls(camera, renderer.domElement);
    controls.addEventListener("change", render);

    // âœ” Correct event listeners
    document.getElementById("btn-table").onclick = () => transform(targets.table);
    document.getElementById("btn-sphere").onclick = () => transform(targets.sphere);
    document.getElementById("btn-helix").onclick = () => transform(targets.helix);
    document.getElementById("btn-grid").onclick = () => transform(targets.grid);

    transform(targets.table);
    window.addEventListener("resize", onWindowResize);
}

function transform(target) {
    TWEEN.removeAll();

    for (let i = 0; i < objects.length; i++) {
        const obj = objects[i];
        const t = target[i];

        new TWEEN.Tween(obj.position)
            .to({ x: t.position.x, y: t.position.y, z: t.position.z }, 1500)
            .easing(TWEEN.Easing.Exponential.InOut)
            .start();

        new TWEEN.Tween(obj.rotation)
            .to({ x: t.rotation.x, y: t.rotation.y, z: t.rotation.z }, 1500)
            .easing(TWEEN.Easing.Exponential.InOut)
            .start();
    }

    new TWEEN.Tween({})
        .to({}, 1500)
        .onUpdate(render)
        .start();
}

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
    render();
}

function animate() {
    requestAnimationFrame(animate);
    TWEEN.update();
    controls.update();
}

function render() {
    renderer.render(scene, camera);
}
</script>

</body>
</html>
